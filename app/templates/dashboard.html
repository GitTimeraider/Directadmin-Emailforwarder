{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Email Forwarder Management</h1>

    <div id="messageContainer"></div>

    {% if not current_user.has_da_config() %}
        <div class="alert alert-warning">
            <p>DirectAdmin is not configured. Please <a href="{{ url_for('settings.index') }}">configure your settings</a> first.</p>
        </div>
    {% else %}
        <!-- Create Forwarder Form -->
        <div class="card">
            <h3>Create New Forwarder</h3>
            <form id="createForwarderForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="address">Email Address</label>
                        <div class="input-group">
                            <input type="text" id="alias" name="alias" required pattern="[-a-zA-Z0-9._]+" title="Alphanumeric characters, dots, underscores, and hyphens only" class="input-bar">
                            <span class="input-addon">@{{ current_user.da_domain }}</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="destination">Forward To</label>
                        <select id="destination" name="destination" required class="input-bar">
                            <option value="">Loading email accounts...</option>
                        </select>
                        <input type="text" id="custom-destination" name="custom-destination" 
                               placeholder="Enter email address or special destination (e.g., :blackhole:)" 
                               class="input-bar hidden-input">
                    </div>

                    <div class="form-group form-actions">
                        <button type="submit" class="btn-primary">Create Forwarder</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Existing Forwarders -->
        <div class="card">
            <h3>Existing Forwarders</h3>
            <div class="table-container">
                <table id="forwardersTable">
                    <thead>
                        <tr>
                            <th>From</th>
                            <th>To</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" class="loading">Loading forwarders...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
{% endblock %}
